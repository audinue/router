var router=(()=>{var $=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var re=Object.prototype.hasOwnProperty;var oe=(e,t)=>{for(var r in t)$(e,r,{get:t[r],enumerable:!0})},le=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of te(t))!re.call(e,l)&&l!==r&&$(e,l,{get:()=>t[l],enumerable:!(o=ee(t,l))||o.enumerable});return e};var ae=e=>le($({},"__esModule",{value:!0}),e);var ce={};oe(ce,{all:()=>X,bind:()=>F,cache:()=>j,fetch:()=>x,get:()=>V,hash:()=>J,post:()=>W,push:()=>q,redirect:()=>K,reload:()=>m,replace:()=>I,subscribe:()=>B,update:()=>_});var c=location.origin==="file://",R="body",S=!1,d=!1,J=()=>{c=!0},F=e=>{R=e},_=()=>{S=!0},j=()=>{d=!0};var s,z=()=>{s=document.querySelector(R)};var g=[],B=e=>(g.push(e),()=>{let t=g.indexOf(e);t>-1&&g.splice(t,1)}),A=e=>{for(let t=g.length-1;t>-1;t--)g[t](e)};var O={},K=e=>({tag:O,location:e}),L=(e,t)=>t&&t.tag===O?t:{tag:O,body:t,url:e.url};var C=[],y=[],Q=[{path:"/404",fetch:e=>L(e,`<pre>Unable to ${e.method} ${e.url.pathname}</pre>`)},{path:"/500",fetch:e=>(console.error(e.error),L(e,`<pre>${e.error.stack}</pre>`))}],U=e=>(t,r)=>{console.log(t,"^"+t.replace(/[/.-]/g,"\\$&").replace(/\:([^\\]+)/g,"(?<$1>[^/]+)").replace(/\*(.+)/g,"(?<$1>.*)")+"$");let o=new RegExp("^"+t.replace(/[/.-]/g,"\\$&").replace(/\:([^\\]+)/g,"(?<$1>[^/]+)").replace(/\*(.+)/g,"(?<$1>.*)")+"$"),l={path:t,match:i=>{if(e.includes(i.method)){let a=o.exec(i.url.pathname);if(a)return a.groups??{}}},fetch:async(i,a,n)=>L(i,await Promise.resolve(r(i,a,n)))};r.length===3?C.push(l):y.push(l)},V=U(["GET"]),W=U(["POST"]),X=U(["GET","POST"]);var k=e=>e.origin===location.origin,D=e=>e.target===""||e.target==="_self",H=e=>c?"#"+e.pathname+e.search:e,M=e=>[...y,...Q].find(t=>t.path===e).fetch,E=e=>e.hasAttribute("replace")?"REPLACE":"PUSH",T=(e,t)=>e&&e.method===t.method&&e.url===t.url,G=e=>{s.innerHTML=e;let t=s.querySelector("[autofocus]");t&&t.focus()};var Y=async e=>{let t=r=>C.reduce((o,l)=>{let i=l.match(e);return i?a=>l.fetch(a,i,o):o},r);try{for(let r of y){let o=r.match(e);if(o)return await t(r.fetch)({...e,params:o})}return await t(M("/404"))(e)}catch(r){return await t(M("/500"))({...e,error:r})}};var b=e=>new URL(e,c?new URL(location.hash.substring(1),location.origin):new URL(location.href));var Z={},w=(e,t)=>e&&e.tag===Z?e:(e=b(e),{tag:Z,method:"GET",url:e,params:{},query:e.searchParams,...t});var x=async(e,t)=>{let r=w(e,t),o=await Y(r);return o.location?x(new URL(o.location,r.url)):o};var p=null,P=null,N=()=>{p!==null&&(p=null,P!==null?clearTimeout(P):(s.classList.remove("loading"),A({type:"loaded"})))},u,h=async(e,t)=>{let r=w(e,t),o={method:r.method,url:r.url.toString()};if(T(p,o))return;p||(P=setTimeout(()=>{P=null,s.classList.add("loading"),A({type:"loading"})},500)),p=o,d&&!u&&(u=JSON.parse(localStorage.getItem("caches")||"{}"));let l=H(r.url),i=d&&r.method!=="POST"&&!r.restored&&l in u;if(i){let a=u[l];G(a.body),r.state==="REPLACE"?history.replaceState(a.body,"",a.url):history.pushState(a.body,"",a.url),scrollTo(0,0)}try{let a=await x(r),n=String(a.body),f=H(a.url);T(p,o)&&(G(n),i?history.replaceState(n,"",f):l!==f?r.state==="REPLACE"?(history.replaceState(null,"",l),history.replaceState(n,"",f)):(history.pushState(null,"",l),history.replaceState(n,"",f)):r.state==="REPLACE"?history.replaceState(n,"",f):history.pushState(n,"",f),!r.restored&&!i&&scrollTo(0,0)),d&&r.method!=="POST"&&(u[l]={body:n,url:f},localStorage.setItem("caches",JSON.stringify(u)))}finally{T(p,o)&&N()}},q=h,I=(e,t)=>{h(e,{state:"REPLACE",...t})},m=e=>{I("",e)};var ie=e=>{e.state!==null&&(s.innerHTML=e.state,N(),S&&m({restored:!0}))},se=()=>{c&&history.state===null&&m()},ne=e=>{if(e.target.nodeName==="A"&&D(e.target)){let t=e.target.getAttribute("href");if(t!==null){let r=b(t);k(r)&&(e.preventDefault(),h(r,{state:E(e.target)}))}}},fe=e=>{if(D(e.target)){let t=b(e.target.getAttribute("action")||"");if(k(t)){e.preventDefault();let r=new FormData(e.target,e.submitter);if(e.target.method==="get"){for(let[o,l]of r)t.searchParams.set(o,l);h(t,{state:E(e.target)})}else h(t,{state:E(e.target),method:"POST",body:r})}}},v=()=>{z(),history.state!==null?(s.innerHTML=history.state,S&&m({restored:!0})):m(),addEventListener("popstate",ie),addEventListener("hashchange",se),addEventListener("click",ne),addEventListener("submit",fe)};addEventListener("DOMContentLoaded",v);return ae(ce);})();
//# sourceMappingURL=router.js.map
