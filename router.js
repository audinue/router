var router=(()=>{var T=Object.defineProperty;var tt=Object.getOwnPropertyDescriptor;var et=Object.getOwnPropertyNames;var rt=Object.prototype.hasOwnProperty;var ot=(t,e)=>{for(var r in e)T(t,r,{get:e[r],enumerable:!0})},at=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of et(e))!rt.call(t,a)&&a!==r&&T(t,a,{get:()=>e[a],enumerable:!(o=tt(e,a))||o.enumerable});return t};var lt=t=>at(T({},"__esModule",{value:!0}),t);var pt={};ot(pt,{all:()=>X,bind:()=>F,cache:()=>j,fetch:()=>x,get:()=>V,hash:()=>J,post:()=>W,push:()=>q,redirect:()=>K,reload:()=>h,replace:()=>I,subscribe:()=>B,update:()=>_});var p=location.origin==="file://",R="body",A=!1,d=!1,J=()=>{p=!0},F=t=>{R=t},_=()=>{A=!0},j=()=>{d=!0};var n,z=()=>{n=document.querySelector(R)};var g=[],B=t=>(g.push(t),()=>{let e=g.indexOf(t);e>-1&&g.splice(e,1)}),O=t=>{for(let e=g.length-1;e>-1;e--)g[e](t)};var C={},K=t=>({tag:C,location:t}),S=(t,e)=>e&&e.tag===C?e:{tag:C,body:e,url:t.url};var U=[],y=[],Q=[{path:"/404",fetch:t=>S(t,`<pre>Unable to ${t.method} ${t.url.pathname}</pre>`)},{path:"/500",fetch:t=>(console.error(t.error),S(t,`<pre>${t.error.stack}</pre>`))}],$=t=>(e,r)=>{let o=new RegExp("^"+e.replace(/[/.-]/g,"\\$&").replace(/\:([^/]+)/g,"(?<$1>[^/]+)").replace(/\*(.+)/g,"(?<$1>.*)")+"$"),a={path:e,match:i=>{if(t.includes(i.method)){let l=o.exec(i.url.pathname);if(l)return l.groups??{}}},fetch:async(i,l,s)=>S(i,await Promise.resolve(r(i,l,s)))};r.length===3?U.push(a):y.push(a)},V=$(["GET"]),W=$(["POST"]),X=$(["GET","POST"]);var k=t=>t.origin===location.origin,D=t=>t.target===""||t.target==="_self",G=t=>p?"#"+t.pathname+t.search:t,H=t=>[...y,...Q].find(e=>e.path===t).fetch,L=t=>t.hasAttribute("replace")?"REPLACE":"PUSH",E=(t,e)=>t&&t.method===e.method&&t.url===e.url,M=t=>{n.innerHTML=t;let e=n.querySelector("[autofocus]");e&&e.focus()};var Y=async t=>{let e=r=>U.reduce((o,a)=>{let i=a.match(t);return i?l=>a.fetch(l,i,o):o},r);try{for(let r of y){let o=r.match(t);if(o)return await e(r.fetch)({...t,params:o})}return await e(H("/404"))(t)}catch(r){return await e(H("/500"))({...t,error:r})}};var b=t=>new URL(t,p?new URL(location.hash.substring(1),location.origin):new URL(location.href));var Z={},w=(t,e)=>t&&t.tag===Z?t:(t=b(t),{tag:Z,method:"GET",url:t,params:{},query:t.searchParams,...e});var x=async(t,e)=>{let r=w(t,e),o=await Y(r);return o.location?x(new URL(o.location,r.url)):o};var m=null,P=null,N=()=>{m!==null&&(m=null,P!==null?clearTimeout(P):(n.classList.remove("loading"),O({type:"loaded"})))},c,u=async(t,e)=>{let r=w(t,e),o={method:r.method,url:r.url.toString()};if(E(m,o))return;m||(P=setTimeout(()=>{P=null,n.classList.add("loading"),O({type:"loading"})},100)),m=o,d&&!c&&(c=JSON.parse(localStorage.getItem("caches")||"{}"));let a=G(r.url),i=d&&r.method!=="POST"&&!r.restored&&a in c;if(i){let l=c[a];M(l.body),r.state==="REPLACE"?history.replaceState(l.body,"",l.url):history.pushState(l.body,"",l.url)}try{let l=await x(r),s=String(l.body),f=G(l.url);E(m,o)&&(M(s),i?history.replaceState(s,"",f):a!==f?r.state==="REPLACE"?(history.replaceState(null,"",a),history.replaceState(s,"",f)):(history.pushState(null,"",a),history.replaceState(s,"",f)):r.state==="REPLACE"?history.replaceState(s,"",f):history.pushState(s,"",f)),d&&r.method!=="POST"&&(c[a]={body:s,url:f},localStorage.setItem("caches",JSON.stringify(c)))}finally{E(m,o)&&N()}},q=u,I=(t,e)=>{u(t,{state:"REPLACE",...e})},h=t=>{I("",t)};var it=t=>{t.state!==null&&(n.innerHTML=t.state,N(),A&&h({restored:!0}))},st=()=>{p&&history.state===null&&h()},nt=t=>{if(t.target.nodeName==="A"&&D(t.target)){let e=t.target.getAttribute("href");if(e!==null){let r=b(e);k(r)&&(t.preventDefault(),u(r,{state:L(t.target)}))}}},ft=t=>{if(D(t.target)){let e=b(t.target.getAttribute("action")||"");if(k(e)){t.preventDefault();let r=new FormData(t.target,t.submitter);if(t.target.method==="get"){for(let[o,a]of r)e.searchParams.set(o,a);u(e,{state:L(t.target)})}else u(e,{state:L(t.target),method:"POST",body:r})}}},v=()=>{z(),h(),addEventListener("popstate",it),addEventListener("hashchange",st),addEventListener("click",nt),addEventListener("submit",ft)};addEventListener("DOMContentLoaded",v);return lt(pt);})();
//# sourceMappingURL=router.js.map
